<html>
  <head>
    <title>Iran Major Earthquakes</title>
    <meta name="description" content="Major earthquakes happend in Iran since 2006. زلزله‌ های بزرگ ایران.">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

    <style>
      body {
      }
      .province path {
          stroke: white;
          stroke-width: 1px;
          fill-opacity: .8;

      }
      #map {
        margin-left:auto;
        margin-right:auto;
        position: relative;
      }
      header {
        background:#315988;
        background: url(coloredgimp.png) repeat;
        color:white;
        padding:20px;
        font-family: "Yekan","Helvetica Neue",Helvetica,Arial,sans-serif;
      }
      .font {
        font-family: 'Roboto Condensed', sans-serif;
      }
      .pageheader {
        font-family: 'Roboto Condensed', sans-serif;
        line-height: 50px;
        font-size: 30px;
      }
      .center {
        float: none;
        margin-left: auto;
        margin-right: auto;
      }
      .bubble {
        fill: #CC333F;
        fill-opacity: 0.6;
        stroke: white;
        stroke-width:0.3px;
        -o-transition:.5s;
        -ms-transition:.5s;
        -moz-transition:.5s;
        -webkit-transition:.5s;
        /* ...and now for the proper property */
        transition:.5s;
      }

      .bubble:hover{
        fill:#00477F;
        fill-opacity:0.8;
      }

      path {
        fill: steelblue;
        fill-opacity: 0.8;
      }
      .tip {
        position: absolute;
        background-color: #000; color: #FFF; max-width: 200px; padding: 5px 8px 4px 8px; text-align: center;
        font-size: 10px; position: absolute; padding: 5px; z-index: 100000;
        opacity: 0.7;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: white;
        shape-rendering: crispEdges;
      }

      .brush .extent {
        stroke: #fff;
        fill-opacity: .125;
        shape-rendering: crispEdges;
      }
      
      .timespan {
        fill:steelblue;
        fill-opacity:0.7;
        stroke: black;
        stroke-width:0.5px;
      }   
      .tick text {
        fill:white;
        fill-opacity:0.6;
      }
      td {
        font-size: small;
      }
      .th {
        font-weight: bold;
        font-size: 16px;
      }
      .info {
        padding: 5px;
      }
    </style>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38791134-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

  </head>
  <body style="background: url(grey.png) repeat;">
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <header>
    <div class="row">
      <div class="span3 pull-right">
        <img src="icon.png" style="vertical-align:middle;" class="pull-right">
      </div>
      <div class="span pull-left pageheader">
        Iran Major Earthquakes

      </div>
    </div>
    </header>
    <section>
      <div class="rows">
        <div class="span4 hide">
          <hr>
          <div>
            <p>
              Iran quakes shows the major earthquakes happened in Iran.
            </p>
          </div>
        </div>
        <div class="span12 center" style="padding:20px">
          <div id="loading" style="margin:50px; text-align:center" class="center">
            <h2>Please wait...</h2>
          </div>
          <div id="map" class="hide">
            <div>
              <span>
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="slashnsr">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
              </span>
              <span class="fb-like" data-href="http://iranquakes.com" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></span>
            </div>
            <div class="font" style="text-align: center">
              Drag/click a time range below.
            </div>
            <div class="tip hide">
              <table style="color:white;">
                  <tr>
                      <td><span class="th">Region</span></td>
                      <td><span class="info" id="region"></span> </td>
                  </tr>
                  <tr>
                      <td><span class="th">Date</span></td>
                      <td><span class="info" id="date"></span></td>
                  </tr>            <tr>
                  <tr>
                      <td><span class="th">Time</span></td>
                      <td><span class="info" id="time"></span></td>
                  </tr>            <tr>
                  <tr>
                      <td><span class="th">Magnitude</span></td>
                      <td><span class="info" id="magnitude"></span></td>
                  </tr>
                      <td><span class="th">Lattitude</span></td>
                      <td><span class="info" id="lattitude"></span></td>
                  </tr>
                  <tr>
                      <td><span class="th">Longitude</span></td>
                      <td><span class="info" id="longitude"></span></td>
                  </tr>
                  <tr>
                      <td><span class="th">Depth (Km)</span></td>
                      <td><span class="info" id="depth"></span></td>
                  </tr>
              </table>

            </div>
          </div>
        </div>
      </div>
    </section>

    <script>

    var bubbles;
    var iran;
      $(document).ready(function() {
            var date_human = d3.time.format("%d %b %Y");
            var time_human = d3.time.format("%X");
           d3.json("data.json", function(error, data) {
             if (error) return console.warn(error);

             var json = data.features;

              bubbles = json.filter(function(e,i , arr) {
                return e.geometry.coordinates[1] < 40;
              });
              var parseDate = d3.time.format("%Y/%m/%d %X").parse;
              for (var i=0; i < bubbles.length; i++) {
                var item = bubbles[i];
                item.date = new Date(parseInt(item.properties.time));
                item.longitude = item.geometry.coordinates[0];
                item.lattitude = item.geometry.coordinates[1];
                item.magnitude = item.properties.mag;
              }
              iran = IranGeo()
                  .width(1000)
                  .height(800)
                  .onmouseover(function(d) {
                  })
                  .bubbles(bubbles)
                  .bubbleOver(function(d) {
                    var projection = iran.projection();
                    var r = iran.magnitude(d.properties.mag)/10050;

                    $('#region').html(d.properties.place);
                    $('#date').html(date_human(d.date));
                    $('#time').html(time_human(d.date));
                    $('#magnitude').html(d.properties.mag);
                    $('#lattitude').html(d.lattitude);
                    $('#longitude').html(d.longitude);
                    $('#depth').html(d.properties.gap);
                    var vals = projection([d.longitude, d.lattitude]);
                    console.log();
                    d3.select('.tip')
                      .style('left', d3.mouse(this)[0] + 15 ) //vals[0] - r - 5)
                      .style('top', d3.mouse(this)[1] + 15) //vals[1])
                      .style('display', 'block');
                  })
                  .bubbleOut(function(d) {
                    d3.select('.tip')
                      .style('display', 'none');
                  });
              var selection = d3.select("#map").datum([]);
              iran(selection);
              $('#loading').fadeOut('slow', function() {
                $('#map').fadeIn('slow', function() {
                  $('#loading').remove();
                });
              });
           });

      });

    </script>
    <div id="footer">
      <div class="container">
        <p class="muted credit">Created by <a target="_blank" href="https://github.com/nasir5959/">Nasir Shadravan</a> and <a target="_blank" href="https://github.com/uunbound/">Peyman Shojaei</a>.

          <span class="pull-right">The data is extracted from <a target="_blank" href="http://earthquake.usgs.gov/">United States Geological Survey</a></span>
        </p>

      </div>
    </div>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
    <script src="irangeo.js"></script>
    <div>
      <img class="thumb hide" src="snap.png">
    </div>
  </body>
</html>
